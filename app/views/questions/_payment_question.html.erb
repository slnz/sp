<% @payment = SpPayment.new %>
<% @application = @answer_sheet %>
<div id="<%= dom_id(payment_question) %>">
  <h2>
    Payment
  </h2>
  <% if @application %>
    <p>
      Application Fee: <%= number_to_currency(SpApplication.cost) %>
    </p>
    <p>
      Current payments:
    </p>
    <table cellspacing="0" class="list" style="margin-bottom: 27px; width: 95%;">
      <tbody id="payment_table">
        <tr>
          <th>
            Payment Type
          </th>
          <th>
            Payment Date
          </th>
          <th>
            Amount Paid
          </th>
          <th>
            &nbsp;
          </th>
        </tr>
				<% if @application.payments.empty? %>
	        <tr>
	          <td colspan="3" id="no-payments" <% if @application.payments.length > 0 -%> style="display: none;" <% end -%>>
	            You have not yet applied any payments to this application.
	          </td>
	        </tr>
				<% else %>
					<% @application.payments.each do |payment| -%><%= render :partial => 'payments/payment', :locals => {:payment => payment}%><% end -%>
				<% end %>
      </tbody>
    </table>
    <p>
      Please select one of the following three options for paying your application fee.
    </p>
    <div id="payment_errors">
      <%= render :partial => "payments/errors", :locals => {:payment => @payment} %>
    </div>
		<% unless @application.has_paid? %>
	    <ul class="list-choices">
	      <li>
	        <%= radio_button :payment, :payment_type, "Credit Card", {:onclick => "swapPayment('credit');",
	                            :disabled => @application.frozen?&&@reference.nil?,
	                            :readonly => @application.frozen?&&@reference.nil?} %><label for="payment_payment_type_credit_card">Credit/Debit Card (Fastest - Processed immediately online)</label>
	        <div id="pay_credit" class="pay_view" <% unless @payment.payment_type == "Credit Card" -%> style="display: none;" <% end -%>>
	          <%= render :partial => 'payments/credit' %>
	        </div>
	      </li>
	      <li>
	        <%= radio_button :payment, :payment_type, "Mail", {:onclick => "swapPayment('mail');",
	                            :disabled => @application.frozen?&&@reference.nil?,
	                            :readonly => @application.frozen?&&@reference.nil?} %><label for="payment_payment_type_mail">Check or Money Order via Postal Mail</label>
	        <div id="pay_mail" class="pay_view" <% unless @payment.payment_type == "Mail" -%> style="display: none;" <% end -%>>
	          <%= render :partial => 'payments/mail' %>
	        </div>
	      </li>
	      <li>
	        <%= radio_button :payment, :payment_type, "Staff", {:onclick => "swapPayment('staff');",
	                            :disabled => @application.frozen?&&@reference.nil?,
	                            :readonly => @application.frozen?&&@reference.nil?} %><label for="payment_payment_type_staff">Transfer from a Staff/Project/Scholarship Fund</label>
	        <div id="pay_staff" class="pay_view" <% unless @payment.payment_type == "Staff" -%> style="display: none;" <% end -%>>
	          <%= render :partial => 'payments/staff' %>
	        </div>
	      </li>
	    </ul>
		<% end %>
  <% end -%>
</div>
